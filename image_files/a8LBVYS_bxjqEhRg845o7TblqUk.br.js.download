var CopilotSearch;(function(n){var t;(function(t){function ii(t){var l,w,d,it,rt,ut,ft,at,dt,ni,ti,ii,ri,ui,fi,ei;(et=t.locStrings.zeroInputSearchBoxAskMeAnything,ot=t.locStrings.copilotSearchBoxFollowUp,i=_d.querySelector("#b_copilot_search .composer_wrapper textarea"),i)&&(f=_d.querySelector(".composer_wrapper .b_copilot_icon"),r=_d.querySelector("#b_copilot_search .b_copilot_send"),o=_d.querySelector("#b_copilot_search .b_copilot_stop_streaming"),a=_d.querySelector("#b_copilot_search .composer_inner_wrapper"),c=_d.querySelector("#b_copilot_search .composer_container"),e=(l=t.enableAttachment)!==null&&l!==void 0?l:!1,st=(w=t.enableCopyButtonShow)!==null&&w!==void 0?w:!1,ht=t.enableRewardsReportActivity,u=(d=t.isSERPVertical)!==null&&d!==void 0?d:!1,ct=(it=t.goToSERP)!==null&&it!==void 0?it:!1,s=(rt=t.enableSERPComposerNewTab)!==null&&rt!==void 0?rt:!1,vt=(ut=t.enableSERPComposerInst)!==null&&ut!==void 0?ut:!1,lt=(ft=t.enableFeedbackShowAfterStreaming)!==null&&ft!==void 0?ft:!1,k=(at=t.serpComposerFormCode)!==null&&at!==void 0?at:"",h=(dt=t.isMiniSERP)!==null&&dt!==void 0?dt:!1,yt=(ni=t.query)!==null&&ni!==void 0?ni:"",y=(ti=t.enableSideAlignedComposer)!==null&&ti!==void 0?ti:!1,p=(ii=t.enableSERPChat)!==null&&ii!==void 0?ii:!1,pt=(ri=t.fromSerpComposer)!==null&&ri!==void 0?ri:!1,wt=(ui=t.enableAutoSuggestFilterFlare)!==null&&ui!==void 0?ui:!1,bt=(fi=t.enableNewMultiTurnOverlayMode)!==null&&fi!==void 0?fi:!1,kt=(ei=t.logSubmitStatus)!==null&&ei!==void 0?ei:!1,sj_be(i,"input",g),sj_be(i,"keypress",gt),sj_be(i,"focus",ai),sj_be(i,"blur",vi),t.enableComposerPasteHandler&&n.ComposerPasteHandler&&sj_be(i,"paste",n.ComposerPasteHandler.onComposerPaste),e&&(n.AttachmentView.bindAttachmentEventsUI(),n.AttachmentDragDrop.initDragAndDrop()),sj_be(r,"click",function(t){n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.ComposerSubmitButtonClicked);nt(t)}),o&&sj_be(o,"click",function(){var t=n.Helper.getLastTurnId(),u={type:"CopilotSearchStreamingStop",data:{turnId:t}},i=n.Helper.getResponseId();CopilotSearchMessager.postMessageToTurn(t,i,u);n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.StopStreamingClick,"responseId",i);tt();lt&&n.TWrap.addFeedbackToTurn();r.disabled=!1;v=!1;n.Conversation.cleanUpTurnSpacing();n.ErrorState.errorHandler(n.ErrorState.ErrorType.STREAMSTOPPED);st&&sj_evt.fire("ShellStopStreaming")}),y&&(window.addEventListener("resize",b),b()),n.ComposerMenu.init(u,s,k),t.enableModelSwitching&&n.ComposerModelSwitching.init(),sj_evt.bind("csTurnState",function(n){if(n&&n.length>1){var t=n[1];t=="start"?(r.disabled=!0,v=!0):(r.disabled=!1,v=!1)}}))}function ri(){return v}function l(){if(i){i.value="";i.style.height="auto";var t=n.getMode()===n.Helper.CopilotMode.Zero;t?i.setAttribute("placeholder",et):i.setAttribute("placeholder",ot);o&&tt();f&&f.classList.remove(n.Helper.hiddenClassName);u&&(p&&w(),sj_evt.fire(rt));r.classList.add(n.Helper.hiddenClassName);d()}}function ui(){sj_evt.fire("csTurnState","reset")}function d(){a&&a.classList.remove(ft)}function dt(){l();w()}function fi(){var t=_qs("#b_copilot_search .chip_btn.back_btn");sj_be(t,"click",function(){n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.BackButtonClicked);n.changeMode(n.Helper.CopilotMode.Turn)});l();w()}function w(){setTimeout(function(){i&&i.focus()},0)}function ei(){}function oi(t){var i=n.Helper.CopilotSearchState;t===i.Error?ei():t===i.FloatingZeroPage?fi():t===i.FloatCompose?dt():t===i.BlankInput&&dt()}function g(){var t;if(i){typeof Log!="undefined"&&Log.LogFilterFlare&&wt&&Log.LogFilterFlare(["BOP_Input_Received"]);i.value===""?r.classList.add(n.Helper.hiddenClassName):r.classList.remove(n.Helper.hiddenClassName);t=1;i.setAttribute("rows",t.toString());var u=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-top").split("px")[0])||12,f=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-bottom").split("px")[0])||12,o=parseInt(window.getComputedStyle(i,null).getPropertyValue("line-height").split("px")[0])||22;t=Math.max(1,Math.ceil((i.scrollHeight-u-f)/o));(t>1||e&&n.AttachmentManager.hasAttachment())&&a.classList.add(ft);requestAnimationFrame(function(){e&&n.AttachmentView.autoSizeAttachmentContainerUI();i.style.height="auto";i.style.height=i.scrollHeight+"px";e&&n.AttachmentView.resizeAttachmentUI(i.scrollHeight)})}}function gt(t){t.shiftKey||t.key!=="Enter"||nt(t);t.shiftKey&&t.key==="Enter"&&(t.preventDefault(),!i.value||it.test(i.value)||(i.value+="\r\n",g()));t.key!="Enter"&&u&&!at&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"ComposerInput"),at=!0)}function nt(t){var f,o,s;if(t.preventDefault(),!i.value||it.test(i.value)||r.disabled!==!1)kt&&(s=r.disabled?"ComposerSubmitDisabled":"ComposerSubmitEmpty",n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,s));else if((u||p||h)&&typeof Log!="undefined"&&Log.LogFilterFlare&&Log.LogFilterFlare(["webco_composersubmit"]),!p&&(u||h))f=i.value.trim(),n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"ComposerSubmit","query",f),ct?hi(f):ci(f);else{if(o=n.getMode()===n.Helper.CopilotMode.Zero,pt&&n.Helper.getLastTurnId()==null&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ConversationStarted,"convId",n.Helper.getConversationId()),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.ConversationStart)),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart),o&&(n.changeMode(n.Helper.CopilotMode.Turn),n.ZeroPage.hide()),bt&&typeof sj_evt!="undefined"&&typeof _w._bingMultiTurnEmitter!="undefined"){n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"MultiTurnOverlayTriggered","query",i.value,"inputType","Composer");sj_evt.fire("multiturnQuery",{query:i.value});l();return}n.Conversation.generateCopilotResponse(i.value,n.Helper.InputTypes.Text);o&&typeof sj_rra!="undefined"&&ht&&si();e&&n.AttachmentManager.clearAttachmentsData();l()}}function si(){var n=new URL(_d.URL);n.searchParams.set("turnindex","1");sj_rra(n.toString())}function hi(n){var i=_ge("sb_form_q"),r=_ge("sb_form"),t,u;!s&&i&&r?(i.value=n,t=_ge("sb_form_go"),t?t.click():r.submit()):(u=window.location.origin+"/search?q="+n+"&FORM=QBRE",window.open(u,s?"_blank":"_self"))}function ci(n){var i=window.location.origin+"/copilotsearch?q="+n+"&pq="+li()+"&FORM="+k,t;h&&(i+="&webcoms=1");vt?(t=_ge("b_bop_cs_inst"),t&&typeof si_ct=="function"?(t.href=i,t.target=s?"_blank":"_self",window.si_ct(t),t.click()):ni(i)):ni(i)}function ni(n){s||h?window.open(n,"_blank"):window.location.href=n}function li(){if(h)return yt;var t=new URLSearchParams(window.location.search),n=t.get("q");return n?n.trim():""}function ai(){f&&f.classList.add(n.Helper.hiddenClassName);u&&sj_evt.fire(rt);i.value!==""&&r.classList.remove(n.Helper.hiddenClassName)}function vi(){i.value===""&&(r.classList.add(n.Helper.hiddenClassName),e&&n.AttachmentManager.hasAttachment()||(f&&f.classList.remove(n.Helper.hiddenClassName),u&&sj_evt.fire(ti),d()))}function b(){var f=_G.RTL,n=_qs(".b_copilot_search",_d),t=_qs(".composer_container",_d),i=_qs(".composer_side_aligned",_d),r,u;n&&t&&(i?f?(r=_d.body.clientWidth-n.getBoundingClientRect().right,i.style.right="".concat(r,"px")):(u=n.getBoundingClientRect().left,i.style.left="".concat(u,"px")):(t.style.right="0px",t.style.left="0px"))}function yi(){Lib.CssClass.remove(o,n.Helper.hiddenClassName)}function tt(){Lib.CssClass.add(o,n.Helper.hiddenClassName)}function pi(){c&&y&&(Lib.CssClass.add(c,ut),b())}function wi(){c&&y&&(Lib.CssClass.remove(c,ut),b())}var i,it=/^\s*$/,rt="csComposerFocus",ti="csComposerBlur",ut="composer_side_aligned",f,r,o,a,c,ft="multiline",et,ot,e=!1,st=!1,ht=!1,u=!1,ct=!1,s=!1,lt=!1,k="",v=!1,at=!1,vt=!1,h=!1,yt="",y=!1,p=!1,pt=!1,wt=!1,bt=!1,kt=!1;t.initComposer=ii;t.getShouldDisableSubmit=ri;t.resetComposer=l;t.resetSubmitButtonStatus=ui;t.resetComposerLayoutDirection=d;t.focus=w;t.onUpdate=oi;t.resize=g;t.enterSearch=gt;t.onComposerSubmit=nt;t.showStopStreamingButton=yi;t.hideStopStreamingButton=tt;t.showSideAlignComposer=pi;t.hideSideAlignComposer=wi})(t=n.Composer||(n.Composer={}))})(CopilotSearch||(CopilotSearch={}))